<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Karibbean Dealz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="shared.css">
    <link rel="stylesheet" href="products.css">
</head>
<body class="min-h-screen">
    <!-- Demo Notification -->
    <div class="demo-notification">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <i class="fas fa-exclamation-triangle text-amber-500 text-lg"></i>
            </div>
            <div class="ml-3">
                <p class="text-sm text-amber-800">
                    <strong>Demo Site:</strong> This is a presentation showcase. All products and functionality are for demonstration purposes.
                </p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="nav-blur sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <a href="index.html" class="text-2xl font-bold text-gradient">Karibbean Dealz</a>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-gray-700 hover:text-indigo-600 font-medium transition-colors duration-200">Home</a>
                    <a href="products.html" class="text-indigo-600 font-semibold transition-colors duration-200">Products</a>
                    <a href="contact.html" class="text-gray-700 hover:text-indigo-600 font-medium transition-colors duration-200">Support</a>
                    <a href="products.html" class="btn-primary text-white px-6 py-3 rounded-full font-medium shadow-lg">
                        <i class="fas fa-shopping-bag mr-2"></i>Shop Now
                    </a>
                    <!-- Cart Icon -->
                    <div class="cart-icon" id="cartIcon">
                        <i class="fas fa-shopping-cart text-xl text-gray-700"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center">
                    <!-- Cart Icon for Mobile -->
                    <div class="cart-icon mr-4" id="cartIconMobile">
                        <i class="fas fa-shopping-cart text-xl text-gray-700"></i>
                        <span class="cart-count" id="cartCountMobile">0</span>
                    </div>
                    <button title="btn" id="mobileMenuButton" class="text-gray-700 hover:text-indigo-600 p-2">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu fixed inset-0 z-50 bg-white md:hidden">
        <div class="flex flex-col h-full">
            <div class="flex justify-between items-center p-6 border-b">
                <span class="text-2xl font-bold text-gradient">Karibbean Dealz</span>
                <button title="btn" id="closeMobileMenu" class="text-gray-700 p-2">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="flex-1 p-6 space-y-6">
                <a href="index.html" class="block text-xl font-medium text-gray-700 hover:text-indigo-600 transition-colors">Home</a>
                <a href="products.html" class="block text-xl font-medium text-indigo-600 transition-colors">Products</a>
                <a href="contact.html" class="block text-xl font-medium text-gray-700 hover:text-indigo-600 transition-colors">Contact</a>
                <a href="products.html" class="btn-primary text-white px-8 py-4 rounded-full font-medium w-full mt-8 shadow-lg block text-center">
                    <i class="fas fa-shopping-bag mr-2"></i>Start Shopping
                </a>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="flex justify-between items-center p-4 border-b">
            <h2 class="text-xl font-bold">Your Cart</h2>
            <button title="btn" id="closeCart" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="cartItems" class="cart-items">
            <!-- Cart items will be dynamically added here -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="openCheckoutModal()">Checkout</button>
        </div>
    </div>

    <!-- Cart Overlay -->
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Checkout Modal -->
    <div class="checkout-modal" id="checkoutModal">
        <div class="checkout-form">
            <h2 class="text-2xl font-bold mb-6">Complete Your Order</h2>
            
            <div class="order-summary">
                <h3 class="text-lg font-semibold mb-4">Order Summary</h3>
                <div id="orderSummaryItems">
                    <!-- Order summary items will be dynamically added here -->
                </div>
                <div class="order-summary-total">
                    <span class="font-semibold">Total:</span>
                    <span id="orderSummaryTotal" class="font-bold text-indigo-600">$0.00</span>
                </div>
            </div>

            <form id="checkoutForm">
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label for="name" class="form-label">Full Name *</label>
                        <input type="text" id="name" name="name" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address *</label>
                        <input type="email" id="email" name="email" class="form-input" required>
                    </div>
                </div>
                
                <div class="form-group mb-4">
                    <label for="phone" class="form-label">Phone Number *</label>
                    <input type="tel" id="phone" name="phone" class="form-input" required>
                </div>
                
                <div class="form-group mb-4">
                    <label for="address" class="form-label">Delivery Address *</label>
                    <textarea id="address" name="address" class="form-input" rows="3" required></textarea>
                </div>
                
                <div class="form-group mb-4">
                    <label class="form-label">Payment Method *</label>
                    <div class="payment-methods">
                        <div class="payment-method selected" data-method="cash">
                            <i class="fas fa-money-bill-wave text-2xl mb-2"></i>
                            <p>Cash on Delivery</p>
                        </div>
                        <div class="payment-method" data-method="transfer">
                            <i class="fas fa-university text-2xl mb-2"></i>
                            <p>Bank Transfer</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-group mb-6">
                    <label for="notes" class="form-label">Order Notes (Optional)</label>
                    <textarea id="notes" name="notes" class="form-input" rows="3" placeholder="Any special delivery instructions or notes..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" id="cancelCheckout">Cancel</button>
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Place Order
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">
                <i class="fas fa-check"></i>
            </div>
            <h2 class="success-title">Order Placed Successfully!</h2>
            <p class="success-message">Your order has been received and will be processed shortly. You will receive a confirmation message shortly.</p>
            <div class="success-actions">
                <button class="btn-whatsapp" id="whatsappBtn">
                    <i class="fab fa-whatsapp"></i>
                    Track on WhatsApp
                </button>
                <button class="btn-close" id="closeSuccess">Continue Shopping</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1">
        <!-- Products Header -->
        <div class="category-header">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <a href="index.html" class="back-button">
                    <i class="fas fa-arrow-left"></i>
                    Back to Home
                </a>
                <h1 class="text-4xl font-bold mb-4">All Products</h1>
                <p class="text-xl opacity-90">Discover our complete collection</p>
            </div>
        </div>

        <!-- Category Filter -->
        <div class="bg-white border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex overflow-x-auto py-4 space-x-4">
                    <button class="category-filter-btn active" data-category="all">All Products</button>
                    <button class="category-filter-btn" data-category="perfumes">Perfumes</button>
                    <button class="category-filter-btn" data-category="lotions">Lotions</button>
                    <button class="category-filter-btn" data-category="skincare">Skincare</button>
                    <button class="category-filter-btn" data-category="bath">Bath & Body</button>
                    <button class="category-filter-btn" data-category="gifts">Gift Sets</button>
                </div>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="py-12 bg-gray-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="product-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="productsGrid">
                    <!-- Products will be dynamically loaded here -->
                </div>
                
                <!-- Loading State -->
                <div id="loadingState" class="text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
                    <p class="text-gray-600 mt-4">Loading products...</p>
                </div>
                
                <!-- Empty State -->
                <div id="emptyState" class="text-center py-12 hidden">
                    <i class="fas fa-search text-4xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">No products found</h3>
                    <p class="text-gray-500">Try selecting a different category or search term.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-2xl font-bold text-gradient mb-4">Karibbean Dealz</h3>
                    <p class="text-gray-400 mb-6">
                        Your trusted partner for premium beauty products and exceptional shopping experiences.
                    </p>
                    <div class="flex space-x-4">
                         <a href="#" title="Facebook" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-indigo-600 transition-colors" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-facebook-f" aria-hidden="true"></i>
                        <span class="sr-only">Facebook</span>
                        </a>

                        <a href="#" title="Instagram" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-indigo-600 transition-colors" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-instagram" aria-hidden="true"></i>
                        <span class="sr-only">Instagram</span>
                        </a>

                        <a href="#" title="Twitter" class="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center hover:bg-indigo-600 transition-colors" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-twitter" aria-hidden="true"></i>
                        <span class="sr-only">Twitter</span>
                        </a>

                    </div>
                </div>

                <div>
                    <h4 class="font-semibold mb-4 text-white">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">About Us</a></li>
                        <li><a href="contact.html" class="text-gray-400 hover:text-white transition-colors">Contact</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Shipping Info</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Returns</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4 text-white">Customer Care</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Help Center</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Track Order</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">Size Guide</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">FAQs</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold mb-4 text-white">Newsletter</h4>
                    <p class="text-gray-400 mb-4">Subscribe for updates and exclusive offers</p>
                    <div class="flex">
                        <input type="email" placeholder="Your email" class="flex-1 bg-gray-800 text-white px-4 py-3 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <button title="btn" class="btn-primary text-white px-6 py-3 rounded-r-lg">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-800 mt-12 pt-8 text-center">
                <p class="text-gray-400">
                    &copy; 2024 Karibbean Dealz. All rights reserved. 
                    <span class="text-gray-500">(Demo Presentation)</span>
                </p>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button title="btn" id="backToTop" class="fixed bottom-8 right-8 w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 hidden z-50">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="shared.js"></script>
    <script>
        // ===== PRODUCTS PAGE SPECIFIC JAVASCRIPT =====

        // Product Data with Complete Inventory
        const products = {
            all: [
                {
                    id: 1,
                    name: "Eternal Essence",
                    description: "Luxury Eau de Parfum - 100ml",
                    price: 89.99,
                    image: "https://images.unsplash.com/photo-1541643600914-78b084683601?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "perfumes",
                    badge: { type: "new", text: "New" }
                },
                {
                    id: 2,
                    name: "Silk Touch Lotion",
                    description: "Hydrating Body Cream - 250ml",
                    price: 34.99,
                    image: "https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "lotions",
                    badge: { type: "bestseller", text: "Best Seller" }
                },
                {
                    id: 3,
                    name: "Velvet Rose",
                    description: "Floral Perfume Collection - 50ml",
                    price: 79.99,
                    image: "https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "perfumes",
                    badge: { type: "popular", text: "Popular" }
                },
                {
                    id: 4,
                    name: "Ocean Breeze Set",
                    description: "Lotion & Perfume Gift Box",
                    price: 124.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "gifts",
                    badge: { type: "gift", text: "Gift" }
                },
                {
                    id: 5,
                    name: "Noir Mystique",
                    description: "Dark & Mysterious Scent - 75ml",
                    price: 94.99,
                    image: "https://images.unsplash.com/photo-1590736968-fc8b8f802c45?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "perfumes",
                    badge: { type: "mysterious", text: "Mysterious" }
                },
                {
                    id: 6,
                    name: "Citrus Bloom",
                    description: "Fresh Citrus Fragrance - 100ml",
                    price: 69.99,
                    image: "https://images.unsplash.com/photo-1615634260167-46aafc14e842?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "perfumes",
                    badge: { type: "fresh", text: "Fresh" }
                },
                {
                    id: 7,
                    name: "Coconut Dream",
                    description: "Tropical Moisturizing Lotion - 300ml",
                    price: 29.99,
                    image: "https://images.unsplash.com/photo-1571781926291-c477ebfd024b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "lotions",
                    badge: { type: "tropical", text: "Tropical" }
                },
                {
                    id: 8,
                    name: "Shea Butter Bliss",
                    description: "Deep Nourishing Cream - 200ml",
                    price: 39.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "lotions",
                    badge: { type: "rich", text: "Rich" }
                },
                {
                    id: 9,
                    name: "Aloe Vera Soothing",
                    description: "Calming Body Lotion - 250ml",
                    price: 27.99,
                    image: "https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "lotions",
                    badge: { type: "soothing", text: "Soothing" }
                },
                {
                    id: 10,
                    name: "Vitamin C Serum",
                    description: "Anti-aging & Brightening - 30ml",
                    price: 49.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "skincare",
                    badge: { type: "brightening", text: "Brightening" }
                },
                {
                    id: 11,
                    name: "Hyaluronic Acid Cream",
                    description: "Intense Hydration - 50ml",
                    price: 42.99,
                    image: "https://images.unsplash.com/photo-1571781926291-c477ebfd024b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "skincare",
                    badge: { type: "hydrating", text: "Hydrating" }
                },
                {
                    id: 12,
                    name: "Retinol Night Cream",
                    description: "Overnight Renewal - 50ml",
                    price: 59.99,
                    image: "https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "skincare",
                    badge: { type: "antiaging", text: "Anti-aging" }
                },
                {
                    id: 13,
                    name: "Charcoal Face Mask",
                    description: "Deep Cleansing - 100ml",
                    price: 32.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "skincare",
                    badge: { type: "detox", text: "Detox" }
                },
                {
                    id: 14,
                    name: "Lavender Bath Bombs",
                    description: "Set of 6 Relaxing Bombs",
                    price: 24.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "bath",
                    badge: { type: "relaxing", text: "Relaxing" }
                },
                {
                    id: 15,
                    name: "Eucalyptus Body Wash",
                    description: "Refreshing Gel - 500ml",
                    price: 18.99,
                    image: "https://images.unsplash.com/photo-1571781926291-c477ebfd024b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "bath",
                    badge: { type: "invigorating", text: "Invigorating" }
                },
                {
                    id: 16,
                    name: "Rose Petal Bath Salts",
                    description: "Aromatic Blend - 1kg",
                    price: 29.99,
                    image: "https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "bath",
                    badge: { type: "romantic", text: "Romantic" }
                },
                {
                    id: 17,
                    name: "Oatmeal Body Scrub",
                    description: "Gentle Exfoliation - 400ml",
                    price: 22.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "bath",
                    badge: { type: "exfoliating", text: "Exfoliating" }
                },
                {
                    id: 18,
                    name: "Luxury Spa Gift Set",
                    description: "Complete Relaxation Package",
                    price: 149.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "gifts",
                    badge: { type: "premium", text: "Premium" }
                },
                {
                    id: 19,
                    name: "Romantic Evening Set",
                    description: "Perfume & Lotion Duo",
                    price: 89.99,
                    image: "https://images.unsplash.com/photo-1571781926291-c477ebfd024b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "gifts",
                    badge: { type: "romantic", text: "Romantic" }
                },
                {
                    id: 20,
                    name: "Travel Essential Kit",
                    description: "Mini Products for On-the-Go",
                    price: 64.99,
                    image: "https://images.unsplash.com/photo-1608248543803-ba4f8c70ae0b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "gifts",
                    badge: { type: "travel", text: "Travel" }
                },
                {
                    id: 21,
                    name: "Holiday Special Box",
                    description: "Festive Collection 2024",
                    price: 124.99,
                    image: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    category: "gifts",
                    badge: { type: "limited", text: "Limited" }
                }
            ]
        };

        // Current filter state
        let currentCategory = 'all';
        let currentProducts = [];

        /**
         * Load and display products with stock management
         * @param {string} category - Category to filter by
         */
        function loadProducts(category = 'all') {
            const productsGrid = document.getElementById('productsGrid');
            const loadingState = document.getElementById('loadingState');
            const emptyState = document.getElementById('emptyState');
            
            // Show loading state
            loadingState.classList.remove('hidden');
            productsGrid.innerHTML = '';
            emptyState.classList.add('hidden');
            
            // Simulate loading delay for better UX
            setTimeout(() => {
                currentCategory = category;
                currentProducts = category === 'all' ? products.all : products.all.filter(product => product.category === category);
                
                if (currentProducts.length === 0) {
                    loadingState.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    return;
                }
                
                productsGrid.innerHTML = currentProducts.map(product => {
                    const remainingStock = getRemainingStock(product.id);
                    const isOutOfStock = remainingStock === 0;
                    
                    return `
                        <div class="product-card rounded-2xl p-6 text-center" data-product-id="${product.id}">
                            <div class="relative mb-4">
                                <img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover rounded-xl">
                                ${product.badge ? `<div class="product-badge badge-${product.badge.type}">${product.badge.text}</div>` : ''}
                                <div class="stock-badge ${remainingStock > 5 ? 'in-stock' : remainingStock > 0 ? 'low-stock' : 'out-of-stock'}">
                                    ${remainingStock} in stock
                                </div>
                            </div>
                            <h3 class="font-semibold text-lg mb-2 text-gray-800">${product.name}</h3>
                            <p class="text-gray-600 text-sm mb-4">${product.description}</p>
                            <div class="flex justify-between items-center">
                                <span class="text-2xl font-bold text-indigo-600">$${product.price}</span>
                                <button class="btn-primary text-white px-6 py-3 rounded-full text-sm add-to-cart ${isOutOfStock ? 'out-of-stock-btn' : ''}"
                                        data-id="${product.id}" 
                                        data-name="${product.name}" 
                                        data-price="${product.price}" 
                                        data-image="${product.image}"
                                        ${isOutOfStock ? 'disabled' : ''}>
                                    <i class="fas ${isOutOfStock ? 'fa-times' : 'fa-cart-plus'} mr-2"></i>
                                    ${isOutOfStock ? 'Out of Stock' : 'Add to Cart'}
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                loadingState.classList.add('hidden');
                
                // Initialize animations for new products
                initProductAnimations();
                
            }, 500); // Simulated loading delay
        }

        /**
         * Initialize animations for product cards
         */
        function initProductAnimations() {
            const productCards = document.querySelectorAll('.product-card');
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            productCards.forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        }

        /**
         * Initialize category filtering
         */
        function initCategoryFilter() {
            const filterButtons = document.querySelectorAll('.category-filter-btn');
            const urlParams = new URLSearchParams(window.location.search);
            const initialCategory = urlParams.get('category') || 'all';
            
            // Set initial active category from URL parameter
            if (initialCategory !== 'all') {
                const initialButton = document.querySelector(`[data-category="${initialCategory}"]`);
                if (initialButton) {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    initialButton.classList.add('active');
                    loadProducts(initialCategory);
                } else {
                    loadProducts('all');
                }
            } else {
                loadProducts('all');
            }
            
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Load products for selected category
                    const category = this.getAttribute('data-category');
                    loadProducts(category);
                    
                    // Update URL without page reload
                    const url = new URL(window.location);
                    if (category === 'all') {
                        url.searchParams.delete('category');
                    } else {
                        url.searchParams.set('category', category);
                    }
                    window.history.pushState({}, '', url);
                });
            });
        }

        // ===== CHECKOUT MODAL FUNCTIONALITY =====
        function openCheckoutModal() {
            const checkoutModal = document.getElementById('checkoutModal');
            const orderSummaryItems = document.getElementById('orderSummaryItems');
            const orderSummaryTotal = document.getElementById('orderSummaryTotal');
            
            if (cart.length === 0) {
                showNotification('Your cart is empty!', 'warning');
                return;
            }
            
            // Update order summary
            orderSummaryItems.innerHTML = cart.map(item => `
                <div class="order-summary-item flex justify-between py-2 border-b border-gray-200">
                    <span class="text-sm">${item.name} x ${item.quantity}</span>
                    <span class="text-sm font-semibold">$${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            
            orderSummaryTotal.textContent = `$${calculateTotal()}`;
            
            // Show checkout modal
            checkoutModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCheckoutModal() {
            const checkoutModal = document.getElementById('checkoutModal');
            checkoutModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        /**
         * Initialize checkout functionality
         */
        function initCheckout() {
            const checkoutForm = document.getElementById('checkoutForm');
            const cancelCheckout = document.getElementById('cancelCheckout');
            const successModal = document.getElementById('successModal');
            const closeSuccess = document.getElementById('closeSuccess');
            const whatsappBtn = document.getElementById('whatsappBtn');

            // Cancel checkout
            if (cancelCheckout) {
                cancelCheckout.addEventListener('click', closeCheckoutModal);
            }

            // Payment method selection
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Submit checkout form
            if (checkoutForm) {
                checkoutForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Show loading state
                    const submitButton = checkoutForm.querySelector('.btn-submit');
                    const originalText = submitButton.innerHTML;
                    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
                    submitButton.disabled = true;

                    // Get form data
                    const formData = new FormData(checkoutForm);
                    const orderData = {
                        name: formData.get('name'),
                        email: formData.get('email'),
                        phone: formData.get('phone'),
                        address: formData.get('address'),
                        notes: formData.get('notes'),
                        paymentMethod: document.querySelector('.payment-method.selected').getAttribute('data-method'),
                        items: [...cart],
                        total: calculateTotal()
                    };

                    try {
                        // Process the order
                        const success = await processCheckout(orderData);
                        
                        if (success) {
                            // Close checkout modal
                            closeCheckoutModal();
                            
                            // Show success modal
                            successModal.classList.add('active');
                            
                            // Store order data for WhatsApp tracking
                            localStorage.setItem('lastOrder', JSON.stringify(orderData));
                        }
                    } catch (error) {
                        console.error('Checkout error:', error);
                        showNotification('There was an error processing your order. Please try again.', 'error');
                    } finally {
                        // Reset button state
                        submitButton.innerHTML = originalText;
                        submitButton.disabled = false;
                    }
                });
            }

            // Close success modal
            if (closeSuccess) {
                closeSuccess.addEventListener('click', function() {
                    successModal.classList.remove('active');
                });
            }

            // WhatsApp tracking button
            if (whatsappBtn) {
                whatsappBtn.addEventListener('click', function() {
                    const orderData = JSON.parse(localStorage.getItem('lastOrder'));
                    if (orderData) {
                        const phoneNumber = '18001234567';
                        const message = `Order Inquiry - ${orderData.name} - Order Total: $${orderData.total}`;
                        const encodedMessage = encodeURIComponent(message);
                        window.open(`https://wa.me/${phoneNumber}?text=${encodedMessage}`, '_blank');
                    }
                });
            }
        }

        // ===== PAGE INITIALIZATION =====
        function initProductsPage() {
            initCategoryFilter();
            initCheckout();
            
            // Handle browser back/forward buttons
            window.addEventListener('popstate', function() {
                const urlParams = new URLSearchParams(window.location.search);
                const category = urlParams.get('category') || 'all';
                const activeButton = document.querySelector(`[data-category="${category}"]`);
                
                if (activeButton) {
                    document.querySelectorAll('.category-filter-btn').forEach(btn => btn.classList.remove('active'));
                    activeButton.classList.add('active');
                    loadProducts(category);
                }
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initProductsPage();
        });
    </script>
</body>
</html>

